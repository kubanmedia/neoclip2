name: Android Build
on:
push:
branches:
- main
workflow_dispatch:

jobs:
build-android:
runs-on: ubuntu-latest

steps:
  - name: Checkout repo
    uses: actions/checkout@v3

  - name: Set up Node.js
    uses: actions/setup-node@v3
    with:
      node-version: '20'

  - name: Install npm dependencies
    run: npm install

  - name: Download Google Drive ZIP
    run: |
      npm install -g gdown
      gdown "https://drive.google.com/uc?id=1M_xZcY3Vp2kf27QiP90He4aK3wS_5nOB" -O neoclip2-build.zip

  - name: Extract web assets
    run: unzip -o neoclip2-build.zip -d www

  - name: Install Capacitor CLI and Android
    run: npm install @capacitor/cli @capacitor/android --save

  - name: Add Capacitor Android project
    run: npx cap add android || echo "Android project already exists"

  - name: Copy web assets to Android
    run: npx cap copy android

  - name: Build Android APK
    run: |
      cd android
      ./gradlew assembleDebug

  - name: Upload APK
    uses: actions/upload-artifact@v3
    with:
      name: app-debug-apk
      path: android/app/build/outputs/apk/debug/app-debug.apk
